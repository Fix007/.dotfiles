#!/usr/bin/env zsh

set -e
setopt EXTENDED_GLOB

if [[ -z "$1" ]]; then
  echo "usage: $(basename $0) <issue-number>"
  exit 1
fi

# type="$1"
issue="$1"

issue_key="$(jira issue view "${issue}" --raw | jq -r .key)"

title="$(jira issue view "${issue}" --raw | jq -r .fields.summary)"
title="${title// /-}"
title="${title:l}"
title="${title//[^[:alnum:]]/-}"
title="${title//---/-}"
title="${title//--/-}"
title="${title%%-##}"
title="${title//\//-}"

name="$issue_key-$title"

echo ${name:0:120}
